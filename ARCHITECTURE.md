# æŠ€æœ¯æ¶æ„

> ğŸ“‹ **æ¶æ„è¯´æ˜**: æœ¬æ–‡æ¡£æè¿°äº† KawaiiChain Wallet çš„æŠ€æœ¯æ¶æ„è®¾è®¡æ–¹æ¡ˆã€‚ç”±äºé¡¹ç›®å¤„äºæ—©æœŸå¼€å‘é˜¶æ®µï¼Œå®é™…å®ç°å¯èƒ½ä¸è®¾è®¡æ–¹æ¡ˆæœ‰æ‰€è°ƒæ•´ã€‚

## ç³»ç»Ÿæ¦‚è§ˆ

æœ¬é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„å¾®æœåŠ¡æ¶æ„ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œé«˜å¯ç”¨æ€§ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Flutter App   â”‚    â”‚   Web Client    â”‚    â”‚  Admin Panel    â”‚
â”‚   (iOS/Android) â”‚    â”‚   (React/Vue)   â”‚    â”‚   (Next.js)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  API Gateway    â”‚
                    â”‚   (Spring)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Service   â”‚    â”‚ Wallet Service  â”‚    â”‚Payment Service  â”‚
â”‚  (Spring Boot)  â”‚    â”‚ (Spring Boot)   â”‚    â”‚ (Spring Boot)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Database       â”‚
                    â”‚ (PostgreSQL/Redis)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯æ ˆè¯¦æƒ…

### ç§»åŠ¨ç«¯ - Flutter

**é€‰å‹åŸå› **
- è·¨å¹³å°å¼€å‘ï¼Œå‡å°‘ç»´æŠ¤æˆæœ¬
- åŸç”Ÿæ€§èƒ½ï¼Œæµç•…çš„ç”¨æˆ·ä½“éªŒ
- ä¸°å¯Œçš„åŠ å¯†åº“æ”¯æŒ

**æ ¸å¿ƒæŠ€æœ¯**
- **Framework**: Flutter 3.8
- **çŠ¶æ€ç®¡ç†**: Provider / Riverpod
- **ç½‘ç»œè¯·æ±‚**: Dio
- **æœ¬åœ°å­˜å‚¨**: Hive / SQLite
- **å®‰å…¨å­˜å‚¨**: Flutter Secure Storage
- **åŠ å¯†åº“**: cryptoã€pointycastle

**é¡¹ç›®ç»“æ„**
```
lib/
â”œâ”€â”€ core/           # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”œâ”€â”€ crypto/     # åŠ å¯†ç›¸å…³
â”‚   â”œâ”€â”€ network/    # ç½‘ç»œå±‚
â”‚   â””â”€â”€ storage/    # å­˜å‚¨å±‚
â”œâ”€â”€ features/       # åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ auth/       # è®¤è¯
â”‚   â”œâ”€â”€ wallet/     # é’±åŒ…
â”‚   â””â”€â”€ payment/    # æ”¯ä»˜
â”œâ”€â”€ shared/         # å…±äº«ç»„ä»¶
â””â”€â”€ main.dart       # å…¥å£æ–‡ä»¶
```

### åç«¯æœåŠ¡ - Spring Cloud

**æ¶æ„é€‰å‹**
- **æ³¨å†Œä¸­å¿ƒ**: Spring Cloud Alibaba Nacos
- **é…ç½®ä¸­å¿ƒ**: Spring Cloud Alibaba Nacos
- **APIç½‘å…³**: Spring Cloud Gateway
- **ç†”æ–­å™¨**: Spring Cloud Alibaba Sentinel
- **è´Ÿè½½å‡è¡¡**: Spring Cloud LoadBalancer

**å¾®æœåŠ¡åˆ’åˆ†**

#### 1. ç”¨æˆ·æœåŠ¡ (User Service)
```java
// ä¸»è¦èŒè´£
- ç”¨æˆ·æ³¨å†Œç™»å½•
- èº«ä»½éªŒè¯å’Œæˆæƒ
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- KYC éªŒè¯

// æŠ€æœ¯æ ˆ
- Spring Boot 3.5.x
- Spring Security + JWT
- PostgreSQL 17
- Redis 7.0
```

#### 2. é’±åŒ…æœåŠ¡ (Wallet Service)
```java
// ä¸»è¦èŒè´£
- é’±åŒ…åˆ›å»ºå’Œå¯¼å…¥
- ç§é’¥å®‰å…¨ç®¡ç†
- åœ°å€ç”Ÿæˆå’ŒéªŒè¯
- äº¤æ˜“ç­¾å

// æŠ€æœ¯æ ˆ
- Spring Boot 3.5.x
- Web3j (ä»¥å¤ªåŠ)
- BitcoinJ (æ¯”ç‰¹å¸)
- HSM (ç¡¬ä»¶å®‰å…¨æ¨¡å—)
```

#### 3. æ”¯ä»˜æœåŠ¡ (Payment Service)
```java
// ä¸»è¦èŒè´£
- è½¬è´¦äº¤æ˜“å¤„ç†
- å•†æˆ·æ”¯ä»˜é›†æˆ
- äº¤æ˜“è®°å½•ç®¡ç†
- é£é™©æ§åˆ¶

// æŠ€æœ¯æ ˆ
- Spring Boot 3.5.x
- RabbitMQ (æ¶ˆæ¯é˜Ÿåˆ—)
- MongoDB (äº¤æ˜“è®°å½•)
- Elasticsearch (æœç´¢)
```

### å‰ç«¯ç½‘ç«™ - Next.js

**é¡¹ç›®ç»“æ„**
```
src/
â”œâ”€â”€ components/     # é€šç”¨ç»„ä»¶
â”œâ”€â”€ pages/          # é¡µé¢è·¯ç”±
â”œâ”€â”€ styles/         # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ lib/            # å·¥å…·åº“
â”œâ”€â”€ hooks/          # è‡ªå®šä¹‰Hooks
â””â”€â”€ types/          # TypeScriptç±»å‹
```

**æŠ€æœ¯é€‰å‹**
- **Framework**: Next.js 15+
- **æ ·å¼**: Tailwind CSS 4
- **çŠ¶æ€ç®¡ç†**: Zustand
- **UIç»„ä»¶**: Radix UI / Shadcn/ui
- **è¡¨å•å¤„ç†**: React Hook Form
- **æ•°æ®è·å–**: SWR / TanStack Query

## æ•°æ®åº“è®¾è®¡

### MySQL - ä¸»æ•°æ®åº“

[æ•°æ®åº“è®¾è®¡](./DATABASE.md) - åŸºäºPostgreSQLçš„æ•°æ®åº“è®¾è®¡
[æ•°æ®åº“è¿ç»´](./DATABASE-OPERATIONS.md) - åŸºäºPostgreSQLçš„æ•°æ®è¿ç»´è®¡åˆ’

### Redis - ç¼“å­˜å±‚

**ç”¨é€”**
- ä¼šè¯ç®¡ç†
- APIé™æµ
- äº¤æ˜“ç¡®è®¤çŠ¶æ€
- çƒ­ç‚¹æ•°æ®ç¼“å­˜

## å®‰å…¨æ¶æ„

### å¯†é’¥ç®¡ç†

**åˆ†å±‚å®‰å…¨**
```
å®¢æˆ·ç«¯å±‚:
â”œâ”€â”€ ç”¨æˆ·å¯†ç åŠ å¯†æœ¬åœ°ç§é’¥
â”œâ”€â”€ ç”Ÿç‰©è¯†åˆ«äºŒæ¬¡éªŒè¯
â””â”€â”€ æœ¬åœ°å®‰å…¨å­˜å‚¨

æœåŠ¡ç«¯å±‚:
â”œâ”€â”€ JWT Token è®¤è¯
â”œâ”€â”€ API è¯·æ±‚ç­¾åéªŒè¯
â””â”€â”€ æ•æ„Ÿæ“ä½œå¤šé‡éªŒè¯

åŸºç¡€è®¾æ–½:
â”œâ”€â”€ HTTPS å…¨é“¾è·¯åŠ å¯†
â”œâ”€â”€ VPC ç½‘ç»œéš”ç¦»
â””â”€â”€ WAF åº”ç”¨é˜²ç«å¢™
```

**ç§é’¥å­˜å‚¨æ–¹æ¡ˆ**
- å®¢æˆ·ç«¯ä½¿ç”¨ AES-256 åŠ å¯†å­˜å‚¨
- æœåŠ¡ç«¯ä¸å­˜å‚¨ç”¨æˆ·ç§é’¥
- æ”¯æŒç¡¬ä»¶å®‰å…¨æ¨¡å—(HSM)
- å¤šé‡ç­¾åä¼ä¸šæ–¹æ¡ˆ

### äº¤æ˜“å®‰å…¨

**é£æ§ç­–ç•¥**
```java
// äº¤æ˜“é£æ§é…ç½®
@Component
public class RiskControlConfig {
    
    // å•ç¬”é™é¢
    private BigDecimal singleLimit = new BigDecimal("10000");
    
    // æ—¥ç´¯è®¡é™é¢
    private BigDecimal dailyLimit = new BigDecimal("50000");
    
    // å¯ç–‘åœ°å€é»‘åå•æ£€æŸ¥
    public boolean checkBlacklist(String address) {
        // æ£€æŸ¥åœ°å€æ˜¯å¦åœ¨é»‘åå•ä¸­
        return blacklistService.contains(address);
    }
}
```

## åŒºå—é“¾é›†æˆ

### å¤šé“¾æ”¯æŒæ¶æ„

```java
// åŒºå—é“¾é€‚é…å™¨æ¥å£
public interface BlockchainAdapter {
    String generateAddress();
    BigDecimal getBalance(String address);
    String sendTransaction(TransactionRequest request);
    TransactionStatus getTransactionStatus(String txHash);
}

// ä»¥å¤ªåŠå®ç°
@Service
public class EthereumAdapter implements BlockchainAdapter {
    @Autowired
    private Web3j web3j;
    
    @Override
    public String sendTransaction(TransactionRequest request) {
        // ä»¥å¤ªåŠäº¤æ˜“å®ç°
    }
}
```

### äº¤æ˜“ç›‘æ§

**å®æ—¶ç›‘æ§**
- WebSocket æ¨é€äº¤æ˜“çŠ¶æ€
- åŒºå—ç¡®è®¤æ•°è·Ÿè¸ª
- å¼‚å¸¸äº¤æ˜“å‘Šè­¦

## éƒ¨ç½²æ¶æ„

### å®¹å™¨åŒ–éƒ¨ç½²

**Docker é…ç½®**
```dockerfile
# Spring Boot æœåŠ¡
FROM openjdk:21-jre-slim
COPY target/wallet-service.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app.jar"]
```

**Kubernetes é…ç½®**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: wallet-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: wallet-service
  template:
    metadata:
      labels:
        app: wallet-service
    spec:
      containers:
      - name: wallet-service
        image: wallet-service:latest
        ports:
        - containerPort: 8080
```

### ç›‘æ§å’Œæ—¥å¿—

**ç›‘æ§æ ˆ**
- **Prometheus** - æŒ‡æ ‡æ”¶é›†
- **Grafana** - å¯è§†åŒ–é¢æ¿
- **ELK Stack** - æ—¥å¿—åˆ†æ
- **Jaeger** - é“¾è·¯è¿½è¸ª

## æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

**å¤šçº§ç¼“å­˜**
1. **å®¢æˆ·ç«¯ç¼“å­˜** - ç”¨æˆ·æ•°æ®æœ¬åœ°ç¼“å­˜
2. **Redis ç¼“å­˜** - çƒ­ç‚¹æ•°æ®ç¼“å­˜
3. **æ•°æ®åº“ç¼“å­˜** - MySQL æŸ¥è¯¢ç¼“å­˜

### æ•°æ®åº“ä¼˜åŒ–

**åˆ†åº“åˆ†è¡¨ç­–ç•¥**
- æŒ‰ç”¨æˆ·IDåˆ†è¡¨
- æŒ‰æ—¶é—´åˆ†åŒºå­˜å‚¨äº¤æ˜“è®°å½•
- è¯»å†™åˆ†ç¦»æå‡æ€§èƒ½

## å¼€å‘è§„èŒƒ

### API è®¾è®¡è§„èŒƒ

```java
// RESTful API ç¤ºä¾‹
@RestController
@RequestMapping("/api/v1/wallets")
public class WalletController {
    
    @GetMapping("/{id}")
    public ApiResponse<WalletDto> getWallet(@PathVariable Long id) {
        // è·å–é’±åŒ…ä¿¡æ¯
    }
    
    @PostMapping
    public ApiResponse<WalletDto> createWallet(@RequestBody CreateWalletRequest request) {
        // åˆ›å»ºæ–°é’±åŒ…
    }
}
```

### é”™è¯¯å¤„ç†

```java
// ç»Ÿä¸€é”™è¯¯å“åº”
public class ApiResponse<T> {
    private int code;
    private String message;
    private T data;
    
    // æˆåŠŸå“åº”
    public static <T> ApiResponse<T> success(T data) {
        return new ApiResponse<>(200, "Success", data);
    }
    
    // é”™è¯¯å“åº”
    public static <T> ApiResponse<T> error(int code, String message) {
        return new ApiResponse<>(code, message, null);
    }
}
```